# Setting Up Express.js Booking Service

#### **1ï¸âƒ£ Create the Project**
```sh
mkdir booking-service && cd booking-service
npm init -y
```

#### **2ï¸âƒ£ Install Dependencies**
```sh
npm install express pg dotenv amqplib cors body-parser
```
- `express` â†’ Backend framework  
- `pg` â†’ PostgreSQL driver  
- `dotenv` â†’ Manage environment variables  
- `amqplib` â†’ RabbitMQ client  
- `cors` â†’ Enable cross-origin requests  
- `body-parser` â†’ Parse request bodies  

---

## **Define Folder Structure**
```
ğŸ“‚ booking-service
â”œâ”€â”€ ğŸ“‚ src
â”‚   â”œâ”€â”€ ğŸ“‚ routes       # API routes
â”‚   â”œâ”€â”€ ğŸ“‚ controllers  # Business logic
â”‚   â”œâ”€â”€ ğŸ“‚ models       # Database schemas
â”‚   â”œâ”€â”€ ğŸ“‚ services     # RabbitMQ logic
â”œâ”€â”€ ğŸ“„ server.js        # Main entry point
â”œâ”€â”€ ğŸ“„ .env             # Environment variables
â”œâ”€â”€ ğŸ“„ package.json     # Dependencies
```

---

##**Connect to PostgreSQL**

#### **ğŸ”¹ Add .env File**
```ini
PORT=5003
DATABASE_URL=postgres://your_user:your_password@localhost:5432/booking_db
RABBITMQ_URL=amqp://localhost
```

#### **ğŸ”¹ Create Database Connection (ğŸ“‚ src/config/db.js)**
```javascript
const { Pool } = require("pg");
require("dotenv").config();

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

pool.connect()
  .then(() => console.log("ğŸ“¦ Connected to PostgreSQL"))
  .catch((err) => console.error("âŒ Database connection error:", err));

module.exports = pool;
```

---

## **Create a Basic Server**
#### **ğŸ”¹ Create `server.js`**
```javascript
require("dotenv").config();
const express = require("express");
const cors = require("cors");
const bodyParser = require("body-parser");
const bookingRoutes = require("./src/routes/bookingRoutes");

const app = express();
app.use(cors());
app.use(bodyParser.json());

app.use("/api/bookings", bookingRoutes);

const PORT = process.env.PORT || 5003;
app.listen(PORT, () => {
  console.log(`ğŸš€ Booking Service running on http://localhost:${PORT}`);
});
```

---

## **Define API Routes**
#### **ğŸ”¹ Create `src/routes/bookingRoutes.js`**
```javascript
const express = require("express");
const router = express.Router();
const { createBooking, getBookings } = require("../controllers/bookingController");

router.post("/", createBooking);
router.get("/", getBookings);

module.exports = router;
```

#### **ğŸ”¹ Create `src/controllers/bookingController.js`**
```javascript
const pool = require("../config/db");

exports.createBooking = async (req, res) => {
  const { user_id, event_id, tickets } = req.body;

  try {
    const result = await pool.query(
      "INSERT INTO bookings (user_id, event_id, tickets, status) VALUES ($1, $2, $3, 'pending') RETURNING *",
      [user_id, event_id, tickets]
    );
    res.status(201).json(result.rows[0]);
  } catch (error) {
    console.error("Error creating booking:", error);
    res.status(500).json({ error: "Internal Server Error" });
  }
};

exports.getBookings = async (req, res) => {
  try {
    const result = await pool.query("SELECT * FROM bookings");
    res.json(result.rows);
  } catch (error) {
    console.error("Error fetching bookings:", error);
    res.status(500).json({ error: "Internal Server Error" });
  }
};
```

---

## **Set Up PostgreSQL Database**
#### **ğŸ”¹ Run These SQL Commands**
```sql
CREATE DATABASE booking_db;

CREATE TABLE bookings (
  id SERIAL PRIMARY KEY,
  user_id INT NOT NULL,
  event_id INT NOT NULL,
  tickets INT NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## **Test the API**
#### **ğŸ”¹ Start the Server**
```sh
node server.js
```

#### **ğŸ”¹ Test with Postman or cURL**
**1ï¸âƒ£ Create a Booking**
```sh
curl -X POST "http://localhost:5003/api/bookings" \
     -H "Content-Type: application/json" \
     -d '{ "user_id": 1, "event_id": 10, "tickets": 2 }'
```
**2ï¸âƒ£ Fetch All Bookings**
```sh
curl -X GET "http://localhost:5003/api/bookings"
```

---

Since I using **RabbitMQ for asynchronous communication**, you need to **install and set it up** before integrating it into your **Booking Service**.  

---

## **ğŸ“Œ Steps to Install RabbitMQ**
### **ğŸ”¹ Option 1: Install via Docker (Recommended)**
If you have **Docker installed**, you can run RabbitMQ easily:  
```sh
docker run -d --name rabbitmq \
  -p 5672:5672 -p 15672:15672 \
  rabbitmq:3-management
```
- **Port 5672** â†’ Used for communication with services  
- **Port 15672** â†’ Used for the management UI (http://localhost:15672)  
- **Username**: `guest`  
- **Password**: `guest`

---

### **ğŸ”¹ Option 2: Install Manually**
#### **ğŸ”¸ Windows**
1ï¸âƒ£ Download and install **Erlang** ğŸ‘‰ [https://www.erlang.org/downloads](https://www.erlang.org/downloads)  
2ï¸âƒ£ Download and install **RabbitMQ** ğŸ‘‰ [https://www.rabbitmq.com/download.html](https://www.rabbitmq.com/download.html)  
3ï¸âƒ£ Start RabbitMQ:
```sh
rabbitmq-server
```
4ï¸âƒ£ Enable the management UI:
```sh
rabbitmq-plugins enable rabbitmq_management
```
Now, access **http://localhost:15672** in your browser.

#### **ğŸ”¸ Linux (Ubuntu/Debian)**
```sh
sudo apt update
sudo apt install rabbitmq-server -y
sudo systemctl enable rabbitmq-server
sudo systemctl start rabbitmq-server
```
Enable the management UI:
```sh
sudo rabbitmq-plugins enable rabbitmq_management
```
Access **http://localhost:15672** in your browser.

---

### **ğŸ“Œ Verify RabbitMQ is Running**
Run this command:
```sh
rabbitmqctl status
```
It should display **running nodes** and other details.

---

### **ğŸ“Œ Install `amqplib` in Your Express.js Project**
Once RabbitMQ is running, install the **RabbitMQ client** for Node.js:
```sh
npm install amqplib
```
This will allow your **Booking Service** to send and receive messages.

---

Now youâ€™re all set to integrate RabbitMQ into your service! ğŸš€ Let me know if you need help with the code. ğŸ˜Š